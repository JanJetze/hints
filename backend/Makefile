# Makefile for Online Denker backend (chat-service style)

.PHONY: build deploy test clean show-config
ENV ?= development
AWS_PROFILE ?= private-playground

build:
	@echo "üî® Building Lambda functions..."
	@./scripts/build-lambdas.sh
	@echo "‚úÖ Lambda functions built successfully!"

deploy:
	@echo "üöÄ Deploying to environment: $(ENV)"
	@npm run build
	@CDK_ENVIRONMENT=$(ENV) npx cdk deploy --require-approval never --profile $(AWS_PROFILE)
	@echo "‚úÖ Deployment complete!"

test:
	@echo "üß™ Running all tests..."
	@go test ./src/...

clean:
	@echo "üßπ Cleaning build artifacts..."
	@find src/go/lambda -name "bin" -type d -exec rm -rf {} + 2>/dev/null || true
	@rm -rf cdk.out/
	@rm -rf dist/
	@echo "‚úÖ Clean complete!"

show-config:
	@echo "üîç Configuration for environment: $(ENV)"
	@CDK_ENVIRONMENT=$(ENV) npx ts-node -e "import { getEnvironmentConfig } from './src/typescript/config/environment'; const config = getEnvironmentConfig('$(ENV)'); console.log('   Stack:', config.stackName); console.log('   Development Mode:', config.isDevelopment);"
